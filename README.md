# Metabolite-Turnover: Clustering

## Introduction/Motivation
This script was developed for use in analyzing plant metabolomics. This particular script was originally utilized for analyzing amino acids. The script utilizes the XCMS package in R developed by Bioconductor. Ultimately this script takes in the output of the first script in this workflow and allows the user to cluster and visualize their data using various methods.

## Example output (Found in the regressionCluster Folder)
Each of the following files shows a portion of the output generated from originally running this script. Note the formatting of these output files may have been changed in the script, but the data presented is the same. These example output are not necessarily from the same files or times. 
- allData_table.csv
- clusters.pdf
- dendrogram.pdf
- k_finder.pdf
- labeled_table.csv
- unlabeled_table.csv

## Usage Notes
All lines that require editing are between line 32 and 74 in the script. 
### Lines that require editing:
- 32: set your path to where your output data will go. This should be a folder (directory), not a file. 
- 36, 39, 42, 45, 48, 51: Filenames for various output files.  
- 55: Distance calculation option. Options are euclidean, maximum, manhattan, canberra, binary, and minkowski.
- 59: K-Means algorithm options include Hartingan-Wong, Lloyd, Forgy, and MacQueen.
- 60: Hierarchical Clustering Method options include ward.D, ward.D2, single, complete, average, mcquitty, median, and centroid.
- 63: Select the type of analysis you want to conduct. Do you want your results to be based off the labeled compounds, unlabeled, or all the compounds combined. 
- 66: Style of clustering. This is which clustering version will be used to draw the final time series plots. The optiosn are either hierarchical ('h') or K-Means ('k'). 
- 70: Pick the value which will be used in the generation of the clusters. Cluster by regression values ('slope') or abundance ratios ('ratio').
- 74: When plotting the clustered lines, do you want to show a line with each cluster that is the aggregate value of the lines. Set to TRUE to show aggregate lines on the plot for each cluster or set to FALSE to ignore.
- 833: This line will not be edited until after line 829 has been run and will be based of the graphic generated by that line of code. The value of 833 is your k value which determines how many clusters your data will be sorted into. 

### Workflow
- Follow the directions for the first script in this workflow. The data should be saved in the 'out' variable. Maintain the same R Session and then begin working through this script. 
- Update filenames in the script and set the other parameters listed above in the 'Lines that require editing' section. 
- If needed, create the output directory on your computer.
- Install needed packages then run lines 21 and 22 to activate libraries.
- Run 32-74 to set up the various parameters.
- Run 84-807 to read in needed functions.
- Run 813 set output directory
- Run 817  to aggregate the data (output from the metabolite_turnover script) by your designated clustering metric.
- Run 820 to transform the aggregated data into a more usable format for clustering.
- Run 823-825 to remove any incomplete data that may be in your clustering data. Any compounds with incomplete data will be printed to the command line and that incomplete data is stored in a variable named incomplete. 
- Run 829 to generate a plot to help you determine the best k value for your clustering. A k value is the number of clusters your data will be divided into. To determine this from the image generated, determine where both the generated lines reach a horizontal asymptote. *This is where you update line 833 to have the appropriate k value*
- Run 833 to read in this new k value.
- Run 840-841 to run the hierarchical clustering function. This will also display a dendrogram of the results of the clustering. 
- Run 845 to run the k-means clustering function.
- Run 848-849 to store the data from k-means clustering in separate variables. 
- Run 852-857 to add the grouping data onto the rest of the data about each compound and then remove incomplete cases. 
- Run 860 to generate your clustered plots
- If continuing to generate more plots, or do other work in this R session, run line 863 to reset the plotting area.
- (optional) If you would like to have raw data outputs, run lines 866-867 to generate CSVs

## Hegeman Lab - University of Minnesota Twin-Cities
This code was developed for use in the Hegeman Lab at the University of Minnesota Twin-Cities. If you use this script in your research, please don't forget to site us. Additionally, if there are any questions about how to use this code, feel free to contact the lab or the scripts creater directly through GitHub. 
